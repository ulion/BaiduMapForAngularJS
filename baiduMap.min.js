!function(t,n){"use strict";"object"==typeof exports?module.exports=n(require("angular")):"function"==typeof define&&define.amd?define(["angular"],n):n(t.angular)}(window,function(t){"use strict";var n={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(t,n){var e=6378245,a=.006693421622965943,i=this.transformLat(n-105,t-35),o=this.transformLon(n-105,t-35),r=t/180*this.PI,s=Math.sin(r);s=1-a*s*s;var c=Math.sqrt(s);return i=180*i/(e*(1-a)/(s*c)*this.PI),o=180*o/(e/c*Math.cos(r)*this.PI),{lat:i,lon:o}},gcj_encrypt:function(t,n){if(this.outOfChina(t,n))return{lat:t,lon:n};var e=this.delta(t,n);return{lat:t+e.lat,lon:n+e.lon}},gcj_decrypt:function(t,n){if(this.outOfChina(t,n))return{lat:t,lon:n};var e=this.delta(t,n);return{lat:t-e.lat,lon:n-e.lon}},gcj_decrypt_exact:function(t,n){for(var e,a,i=.01,o=1e-9,r=i,s=i,c=t-r,l=n-s,h=t+r,f=n+s,u=0;;){e=(c+h)/2,a=(l+f)/2;var p=this.gcj_encrypt(e,a);if(r=p.lat-t,s=p.lon-n,Math.abs(r)<o&&Math.abs(s)<o)break;if(r>0?h=e:c=e,s>0?f=a:l=a,++u>1e4)break}return{lat:e,lon:a}},bd_encrypt:function(t,n){var e=n,a=t,i=Math.sqrt(e*e+a*a)+2e-5*Math.sin(a*this.x_pi),o=Math.atan2(a,e)+3e-6*Math.cos(e*this.x_pi),r=i*Math.cos(o)+.0065,s=i*Math.sin(o)+.006;return{lat:s,lon:r}},bd_decrypt:function(t,n){var e=n-.0065,a=t-.006,i=Math.sqrt(e*e+a*a)-2e-5*Math.sin(a*this.x_pi),o=Math.atan2(a,e)-3e-6*Math.cos(e*this.x_pi),r=i*Math.cos(o),s=i*Math.sin(o);return{lat:s,lon:r}},gcj_bd_encrypt:function(t,n){var e=this.gcj_encrypt(t,n);return this.bd_encrypt(e.lat,e.lon)},mercator_encrypt:function(t,n){var e=20037508.34*n/180,a=Math.log(Math.tan((90+t)*this.PI/360))/(this.PI/180);return a=20037508.34*a/180,{lat:a,lon:e}},mercator_decrypt:function(t,n){var e=n/20037508.34*180,a=t/20037508.34*180;return a=180/this.PI*(2*Math.atan(Math.exp(a*this.PI/180))-this.PI/2),{lat:a,lon:e}},distance:function(t,n,e,a){var i=6371e3,o=Math.cos(t*this.PI/180)*Math.cos(e*this.PI/180)*Math.cos((n-a)*this.PI/180),r=Math.sin(t*this.PI/180)*Math.sin(e*this.PI/180),s=o+r;s>1&&(s=1),-1>s&&(s=-1);var c=Math.acos(s),l=c*i;return l},outOfChina:function(t,n){return 72.004>n||n>137.8347?!0:.8293>t||t>55.8271?!0:!1},transformLat:function(t,n){var e=-100+2*t+3*n+.2*n*n+.1*t*n+.2*Math.sqrt(Math.abs(t));return e+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,e+=2*(20*Math.sin(n*this.PI)+40*Math.sin(n/3*this.PI))/3,e+=2*(160*Math.sin(n/12*this.PI)+320*Math.sin(n*this.PI/30))/3},transformLon:function(t,n){var e=300+t+2*n+.1*t*t+.1*t*n+.1*Math.sqrt(Math.abs(t));return e+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,e+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,e+=2*(150*Math.sin(t/12*this.PI)+300*Math.sin(t/30*this.PI))/3}},e=function(t,e,a){t.latitude&&(a=e,e=t.longitude,t=t.latitude);var i={lat:t,lon:e};return a&&"WGS-84"==a.toUpperCase()&&(i=n.gcj_bd_encrypt(i.lat,i.lon)),new BMap.Point(i.lon,i.lat)},a=function(t,n){if(!t)throw new Error(n)},i=function(t,n){for(var e in n)"undefined"==typeof t[e]&&(t[e]=n[e])},o=function(){return{restrict:"E",scope:{options:"="},link:function(t,n,o){var r={navCtrl:!0,scaleCtrl:!0,overviewCtrl:!0,enableScrollWheelZoom:!0,zoom:10},s=t.options;i(s,r),a(s.center,"options.center must be set"),a(s.center.longitude,"options.center.longitude must be set"),a(s.center.latitude,"options.center.latitude must be set"),a(s.city,"options.city must be set");var c=new BMap.Map(n.find("div")[0]);if(c.centerAndZoom(e(s.center.latitude,s.center.longitude,s.projection),s.zoom),s.navCtrl&&c.addControl(new BMap.NavigationControl),s.scaleCtrl&&c.addControl(new BMap.ScaleControl),s.overviewCtrl&&c.addControl(new BMap.OverviewMapControl),s.trafficCtrl){var l=new BMapLib.TrafficControl;c.addControl(l),l.setAnchor(s.trafficCtrl.anchor?s.trafficCtrl.anchor:BMAP_ANCHOR_TOP_RIGHT)}if(s.enableScrollWheelZoom&&c.enableScrollWheelZoom(),c.setCurrentCity(s.city),s.markers){var h=[],f=[],u=function(t){return function(){this.openInfoWindow(t)}},p=function(){var t=0;for(t=0;t<h.length;t++)h[t].removeEventListener("click",u(m)),c.removeOverlay(h[t]);for(h.length=0,f=[],t=0;t<s.markers.length;t++){var n=s.markers[t],a=e(n.latitude,n.longitude,s.projection);f.push(a);var i,o=19,r=25;if(n.icon){o=n.icon.width||n.icon.w||o,r=n.icon.height||n.icon.h||r;var l={};n.icon.anchor&&(l.anchor=new BMap.Size(n.icon.anchor.x,n.icon.anchor.y)),n.icon.imageOffset&&(l.imageOffset=new BMap.Size(n.icon.imageOffset.x,n.icon.imageOffset.y));var p=new BMap.Icon(n.icon.url||n.icon,new BMap.Size(o,r),l);i=new BMap.Marker(a,{icon:p})}else i=new BMap.Marker(a);if(n.label){var M=o+1,d=-10;n.label.offset&&(M=n.label.offset.x,d=n.label.offset.y);var v=new BMap.Label(n.label.content||n.label,{offset:new BMap.Size(M,d)});i.setLabel(v)}if(c.addOverlay(i),h.push(i),!n.title&&!n.content)return;var m=new BMap.InfoWindow("<p>"+(n.title?n.title:"")+"</p><p>"+(n.content?n.content:"")+"</p>",{enableMessage:!!n.enableMessage});i.addEventListener("click",u(m))}};p(),t.$watch("options.center",function(n,a){s=t.options,c.panTo(e(s.center.latitude,s.center.longitude,s.projection))},!0),t.$watch("options.zoom",function(n,e){c.setZoom(t.options.zoom)},!0),t.$watch("options.markers",function(t,n){p()},!0),t.$watch("options.viewport",function(n,e){if(n){s=t.options;var a=c.getViewport(f,n||{});c.centerAndZoom(a.center,a.zoom)}},!0)}},template:'<div style="width: 100%; height: 100%;"></div>'}},r=t.module("baiduMap",[]);r.directive("baiduMap",[o])});