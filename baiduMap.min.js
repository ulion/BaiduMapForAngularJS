!function(t,n){"use strict";"object"==typeof exports?module.exports=n(require("angular")):"function"==typeof define&&define.amd?define(["angular"],n):n(t.angular)}(window,function(t){"use strict";var n={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(t,n){var e=6378245,a=.006693421622965943,r=this.transformLat(n-105,t-35),i=this.transformLon(n-105,t-35),o=t/180*this.PI,s=Math.sin(o);s=1-a*s*s;var l=Math.sqrt(s);return r=180*r/(e*(1-a)/(s*l)*this.PI),i=180*i/(e/l*Math.cos(o)*this.PI),{lat:r,lon:i}},gcj_encrypt:function(t,n){if(this.outOfChina(t,n))return{lat:t,lon:n};var e=this.delta(t,n);return{lat:t+e.lat,lon:n+e.lon}},gcj_decrypt:function(t,n){if(this.outOfChina(t,n))return{lat:t,lon:n};var e=this.delta(t,n);return{lat:t-e.lat,lon:n-e.lon}},gcj_decrypt_exact:function(t,n){for(var e,a,r=.01,i=1e-9,o=r,s=r,l=t-o,c=n-s,h=t+o,u=n+s,f=0;;){e=(l+h)/2,a=(c+u)/2;var M=this.gcj_encrypt(e,a);if(o=M.lat-t,s=M.lon-n,Math.abs(o)<i&&Math.abs(s)<i)break;if(o>0?h=e:l=e,s>0?u=a:c=a,++f>1e4)break}return{lat:e,lon:a}},bd_encrypt:function(t,n){var e=n,a=t,r=Math.sqrt(e*e+a*a)+2e-5*Math.sin(a*this.x_pi),i=Math.atan2(a,e)+3e-6*Math.cos(e*this.x_pi),o=r*Math.cos(i)+.0065,s=r*Math.sin(i)+.006;return{lat:s,lon:o}},bd_decrypt:function(t,n){var e=n-.0065,a=t-.006,r=Math.sqrt(e*e+a*a)-2e-5*Math.sin(a*this.x_pi),i=Math.atan2(a,e)-3e-6*Math.cos(e*this.x_pi),o=r*Math.cos(i),s=r*Math.sin(i);return{lat:s,lon:o}},gcj_bd_encrypt:function(t,n){var e=this.gcj_encrypt(t,n);return this.bd_encrypt(e.lat,e.lon)},mercator_encrypt:function(t,n){var e=20037508.34*n/180,a=Math.log(Math.tan((90+t)*this.PI/360))/(this.PI/180);return a=20037508.34*a/180,{lat:a,lon:e}},mercator_decrypt:function(t,n){var e=n/20037508.34*180,a=t/20037508.34*180;return a=180/this.PI*(2*Math.atan(Math.exp(a*this.PI/180))-this.PI/2),{lat:a,lon:e}},distance:function(t,n,e,a){var r=6371e3,i=Math.cos(t*this.PI/180)*Math.cos(e*this.PI/180)*Math.cos((n-a)*this.PI/180),o=Math.sin(t*this.PI/180)*Math.sin(e*this.PI/180),s=i+o;s>1&&(s=1),-1>s&&(s=-1);var l=Math.acos(s),c=l*r;return c},outOfChina:function(t,n){return 72.004>n||n>137.8347?!0:.8293>t||t>55.8271?!0:!1},transformLat:function(t,n){var e=-100+2*t+3*n+.2*n*n+.1*t*n+.2*Math.sqrt(Math.abs(t));return e+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,e+=2*(20*Math.sin(n*this.PI)+40*Math.sin(n/3*this.PI))/3,e+=2*(160*Math.sin(n/12*this.PI)+320*Math.sin(n*this.PI/30))/3},transformLon:function(t,n){var e=300+t+2*n+.1*t*t+.1*t*n+.1*Math.sqrt(Math.abs(t));return e+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,e+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,e+=2*(150*Math.sin(t/12*this.PI)+300*Math.sin(t/30*this.PI))/3}},e=function(t,e,a){t.latitude&&(a=e,e=t.longitude,t=t.latitude);var r={lat:t,lon:e};return a&&"WGS-84"==a.toUpperCase()&&(r=n.gcj_bd_encrypt(r.lat,r.lon)),new BMap.Point(r.lon,r.lat)},a=function(t,n){if(!t)throw new Error(n)},r=function(t,n){for(var e in n)"undefined"==typeof t[e]&&(t[e]=n[e])},i=function(){return{restrict:"E",scope:{options:"="},link:function(t,n,i){var o={navCtrl:!0,scaleCtrl:!0,overviewCtrl:!0,enableScrollWheelZoom:!0,zoom:10},s=t.options;r(s,o),a(s.center,"options.center must be set"),a(s.center.longitude,"options.center.longitude must be set"),a(s.center.latitude,"options.center.latitude must be set"),a(s.city,"options.city must be set");var l=new BMap.Map(n.find("div")[0]);if(l.centerAndZoom(e(s.center.latitude,s.center.longitude,s.projection),s.zoom),s.navCtrl&&l.addControl(new BMap.NavigationControl),s.scaleCtrl&&l.addControl(new BMap.ScaleControl),s.overviewCtrl&&l.addControl(new BMap.OverviewMapControl),s.trafficCtrl){var c=new BMapLib.TrafficControl;l.addControl(c),c.setAnchor(s.trafficCtrl.anchor?s.trafficCtrl.anchor:BMAP_ANCHOR_TOP_RIGHT)}if(s.enableScrollWheelZoom&&l.enableScrollWheelZoom(),l.setCurrentCity(s.city),s.markers){var h=[],u=function(t){return function(){this.openInfoWindow(t)}},f=function(){var t=0;for(t=0;t<h.length;t++)h[t].removeEventListener("click",u(f)),l.removeOverlay(h[t]);for(h.length=0,t=0;t<s.markers.length;t++){var n,a=s.markers[t],r=e(a.latitude,a.longitude,s.projection),i=19;if(a.icon){i=a.width;var o=new BMap.Icon(a.icon,new BMap.Size(a.width,a.height));n=new BMap.Marker(r,{icon:o})}else n=new BMap.Marker(r);if(a.label){var c=new BMap.Label(a.label,{offset:new BMap.Size(i+1,-10)});n.setLabel(c)}if(l.addOverlay(n),h.push(n),!a.title&&!a.content)return;var f=new BMap.InfoWindow("<p>"+(a.title?a.title:"")+"</p><p>"+(a.content?a.content:"")+"</p>",{enableMessage:!!a.enableMessage});n.addEventListener("click",u(f))}};f(),t.$watch("options.center",function(n,a){s=t.options,l.centerAndZoom(e(s.center.latitude,s.center.longitude,s.projection),s.zoom),f()},!0),t.$watch("options.markers",function(t,n){f()},!0)}},template:'<div style="width: 100%; height: 100%;"></div>'}},o=t.module("baiduMap",[]);o.directive("baiduMap",[i])});